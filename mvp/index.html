<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./src/style.css" />
    <title>Tsukiichi Kakeibo MVP</title>
  </head>
  <body>
    <header class="app-header">
      <div>
        <h1>月いち家計簿 MVP</h1>
        <p>ローカルファーストで家計簿と資産推移を管理するダッシュボード</p>
      </div>
      <div class="status" id="db-status">DB: 未初期化</div>
    </header>

    <main class="app-main">
      <section class="card" id="import-section">
        <h2>1. データ取込</h2>
        <div class="import-grid">
          <div>
            <h3>家計簿（明細）</h3>
            <input type="file" id="transactions-file" accept=".csv,.xlsx" />
            <button id="import-transactions">取込</button>
            <button id="clear-transactions" class="secondary">家計簿データ削除</button>
            <p class="hint">Excelは「マスタ」シート、CSVはヘッダー付きで読み込みます。</p>
          </div>
          <div>
            <h3>資産推移</h3>
            <input type="file" id="assets-file" accept=".csv,.xlsx" />
            <button id="import-assets">取込</button>
            <p class="hint">Excelは「資産推移」シート、CSVはヘッダー付きで読み込みます。</p>
            <div class="hint">
              同一日付のデータ:
              <label><input type="radio" name="asset-dup" value="overwrite" checked />上書き</label>
              <label><input type="radio" name="asset-dup" value="skip" />スキップ</label>
            </div>
            <div class="import-meta" id="asset-import-meta"></div>
            <div class="import-preview" id="asset-import-preview"></div>
            <div class="import-mapping" id="asset-import-mapping"></div>
            <div class="import-errors" id="asset-import-errors"></div>
          </div>
          <div>
            <h3>サンプル</h3>
            <p class="hint">sample-data/transactions_sample.csv と assets_sample.csv を利用できます。</p>
          </div>
        </div>
        <div class="import-result" id="import-result"></div>
      </section>

      <section class="card" id="dashboard-section">
        <h2>2. ダッシュボード</h2>
        <div class="dashboard-grid">
          <div class="panel">
            <h3>今月の収支</h3>
            <div class="kpi" id="monthly-summary"></div>
          </div>
          <div class="panel">
            <h3>アラート</h3>
            <ul id="alerts" class="list"></ul>
          </div>
        </div>
      </section>

      <section class="card" id="forecast-section">
        <h2>5. 将来シミュレーション (M1)</h2>
        <div class="forecast-grid">
          <label>現在年齢
            <input type="number" id="forecast-current-age" min="18" max="100" value="35" />
          </label>
          <label>予測上限年齢
            <input type="number" id="forecast-max-age" min="20" max="110" value="100" />
          </label>
          <label>年間インフレ率 (%)
            <input type="number" id="forecast-inflation" step="0.1" value="2" />
          </label>
          <label>毎月の収入 (円)
            <input type="number" id="forecast-base-income" step="1000" value="0" />
          </label>
          <label>毎月の支出 (円)
            <input type="number" id="forecast-base-expense" step="1000" value="0" />
          </label>
          <label>現金 年率 (%)
            <input type="number" id="forecast-return-cash" step="0.1" value="0.1" />
          </label>
          <label>株式 年率 (%)
            <input type="number" id="forecast-return-stocks" step="0.1" value="5" />
          </label>
          <label>投信 年率 (%)
            <input type="number" id="forecast-return-funds" step="0.1" value="4" />
          </label>
        </div>

        <div class="forecast-block">
          <h3>年金 (手入力)</h3>
          <div class="forecast-grid">
            <label>開始年齢
              <input type="number" id="pension-start-age" min="50" max="100" value="65" />
            </label>
            <label>終了年齢 (任意)
              <input type="number" id="pension-end-age" min="50" max="110" />
            </label>
            <label>月額 (円)
              <input type="number" id="pension-monthly" step="1000" value="150000" />
            </label>
            <button id="add-pension" type="button">年金を追加</button>
          </div>
          <ul id="pension-list" class="list"></ul>
        </div>

        <div class="forecast-block">
          <h3>ライフイベント: 一時支出/収入</h3>
          <div class="forecast-grid">
            <label>年月
              <input type="month" id="event-once-month" />
            </label>
            <label>金額 (円)
              <input type="number" id="event-once-amount" step="1000" value="-300000" />
            </label>
            <label>ラベル
              <input type="text" id="event-once-label" placeholder="例: 家電買替" />
            </label>
            <button id="add-event-once" type="button">一時イベント追加</button>
          </div>
          <ul id="event-once-list" class="list"></ul>
        </div>

        <div class="forecast-block">
          <h3>ライフイベント: 期間支出/収入</h3>
          <div class="forecast-grid">
            <label>開始年月
              <input type="month" id="event-recurring-start" />
            </label>
            <label>終了年月
              <input type="month" id="event-recurring-end" />
            </label>
            <label>月額 (円)
              <input type="number" id="event-recurring-amount" step="1000" value="-50000" />
            </label>
            <label>ラベル
              <input type="text" id="event-recurring-label" placeholder="例: 教育費" />
            </label>
            <button id="add-event-recurring" type="button">期間イベント追加</button>
          </div>
          <ul id="event-recurring-list" class="list"></ul>
        </div>

        <button id="run-forecast" type="button">予測を再計算</button>
        <div id="forecast-summary" class="forecast-summary"></div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>年</th>
                <th>年齢</th>
                <th>名目資産</th>
                <th>実質資産</th>
                <th>年間収支</th>
              </tr>
            </thead>
            <tbody id="forecast-yearly-body"></tbody>
          </table>
        </div>
      </section>

      <div class="content-grid">
        <div class="content-column">
          <section class="card" id="summary-section">
            <h2>3. 月次集計</h2>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>月</th>
                    <th>収入</th>
                    <th>支出</th>
                    <th>収支</th>
                    <th>振替</th>
                  </tr>
                </thead>
                <tbody id="monthly-body"></tbody>
              </table>
            </div>
          </section>

          <section class="card" id="ledger-section">
            <h2>4. 明細一覧</h2>
            <div class="filters">
              <label>期間(開始)
                <input type="date" id="filter-start" />
              </label>
              <label>期間(終了)
                <input type="date" id="filter-end" />
              </label>
              <label>検索
                <input type="search" id="filter-search" placeholder="内容/メモ/カテゴリ" />
              </label>
              <label>
                <input type="checkbox" id="filter-transfer" /> 振替も表示
              </label>
              <label>
                <input type="checkbox" id="filter-excluded" /> 計算対象外も表示
              </label>
              <button id="refresh-ledger">再表示</button>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>日付</th>
                    <th>内容</th>
                    <th>金額</th>
                    <th>金融機関</th>
                    <th>大項目</th>
                    <th>中項目</th>
                    <th>メモ</th>
                    <th>振替</th>
                    <th>計算対象</th>
                  </tr>
                </thead>
                <tbody id="ledger-body"></tbody>
              </table>
            </div>
          </section>
        </div>

        <div class="content-column">
          <section class="card">
            <h3>大項目別 乖離サマリ</h3>
            <p class="hint" id="category-gap-summary">準備中</p>
          </section>
          <section class="card">
            <h3>今月の主要カテゴリ上位</h3>
            <ol id="top-categories" class="list"></ol>
          </section>
          <section class="card">
            <h3>資産スナップショット</h3>
            <div class="kpi" id="asset-snapshot"></div>
          </section>
        </div>
      </div>

    </main>

    <footer class="app-footer">
      <p>ローカルファースト: 取り込んだデータはIndexedDBに保存され、外部送信は行いません。</p>
    </footer>

    <script type="module" src="./src/main.js"></script>
  </body>
</html>
